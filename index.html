<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Daily Focus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
  body {
    margin: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  header, #dateStrip, #actionZone {
    padding: 8px;
  }

  #actionZone {
    border-bottom: 1px solid #ccc;
  }

  #taskList {
    flex: 1;
    overflow-y: auto;
    padding: 8px;
  }
  #observeBtn {
  margin: 8px;
}

#observationPanel {
  padding: 8px;
}
  /* --- Task States --- */
.task {
  padding: 8px;
  margin-bottom: 6px;
  border-radius: 6px;
}

/* Completed task */
.task.completed {
  color: #2e7d32;
  opacity: 0.7;
}

/* Incomplete today */
.task.incomplete-today {
  color: #222;
}

/* Missed task (past days) */
.task.missed {
  color: #b71c1c;
  opacity: 0.8;
}

/* Read-only look for past days */
.task.read-only {
  cursor: default;
}

/* Clickable look for today */
.task.clickable {
  cursor: pointer;
}
  </style> 

</head>
<body>

  <!-- Header -->
  <header>
    <h1>Daily Focus</h1>
    <p id="fullDate"></p>
  </header>

  <!-- Date Strip -->
  <section id="dateStrip"></section>

  <!-- Action Zone (Fixed Position) -->
<section id="actionZone">
  <input id="newTaskInput" placeholder="Add a task for today">
  <button id="addTaskBtn">Add</button>
</section>

<!-- Scrollable Task List -->
<main id="taskList"></main>
<button id="observeBtn">Observation</button>

<section id="observationPanel" style="display:none;">
  <h3>Observation</h3>
  <p id="obsSummary"></p>
  <canvas id="obsChart" width="200" height="200"></canvas>
</section>
<script>
/* =========================
   Phase 5 — Core Logic
========================= */

const STORAGE_KEY = "daily-focus-data";

// --- Utilities ---
function getToday() {
  return new Date().toISOString().split("T")[0];
}

function loadData() {
  return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
    activeDate: getToday(),
    days: {}
  };
}

function saveData(data) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

// --- App State ---
let data = loadData();
const today = getToday();
data.activeDate = today;

// Ensure today exists
if (!data.days[today]) {
  data.days[today] = [];
}

saveData(data);

// --- Render Header ---
document.getElementById("fullDate").textContent =
  new Date(today).toDateString();

// --- Render Date Strip ---
function renderDateStrip() {
  const strip = document.getElementById("dateStrip");
  strip.innerHTML = "";

  for (let i = 6; i >= 0; i--) {
    const d = new Date();
    d.setDate(d.getDate() - i);
    const dateStr = d.toISOString().split("T")[0];

    const btn = document.createElement("button");
    btn.textContent = d.getDate();
    btn.onclick = () => selectDate(dateStr);

    if (dateStr === data.activeDate) {
      btn.style.fontWeight = "bold";
    }

    strip.appendChild(btn);
  }
}

// --- Select Date ---
function selectDate(date) {
  closeObservation();
  data.activeDate = date;
  saveData(data);
  render();
}

// --- Render Tasks ---
function renderTasks() {
  const list = document.getElementById("taskList");
  list.innerHTML = "";

  const tasks = data.days[data.activeDate] || [];
  const isToday = data.activeDate === today;

  if (tasks.length === 0) {
    list.textContent = "No tasks added on this day.";
    return;
  }

  tasks.forEach((task, index) => {
  const item = document.createElement("div");
  item.classList.add("task");

  const isCompleted = task.completed;
  const isPastDay = !isToday;

  item.textContent = (isCompleted ? "✅ " : "❌ ") + task.text;

  if (isCompleted) {
    item.classList.add("completed");
  } else if (isPastDay) {
    item.classList.add("missed");
  } else {
    item.classList.add("incomplete-today");
  }

  if (isToday) {
    item.classList.add("clickable");
    item.onclick = () => toggleTask(index);
  } else {
    item.classList.add("read-only");
  }

  list.appendChild(item);
});
}
  
// --- Toggle Task Completion ---
function toggleTask(index) {
  if (data.activeDate !== today) return;

  const task = data.days[today][index];
  task.completed = !task.completed;

  saveData(data);
  renderTasks();
}
  
// --- Add Task ---
document.getElementById("addTaskBtn").onclick = () => {
  if (data.activeDate !== today) return;

  const input = document.getElementById("newTaskInput");
  const text = input.value.trim();
  if (!text) return;

  data.days[today].push({ text, completed: false });
  input.value = "";
  saveData(data);
  renderTasks();
};
// --- Observation Button ---
document.getElementById("observeBtn").onclick = () => {
  toggleObservation();
};

function showObservation() {
  observing = true;

  const panel = document.getElementById("observationPanel");
  const list = document.getElementById("taskList");

  list.style.display = "none";
  panel.style.display = "block";

  const tasks = data.days[data.activeDate] || [];
  const completed = tasks.filter(t => t.completed).length;
  const missed = tasks.length - completed;

  document.getElementById("obsSummary").textContent =
    `Completed: ${completed}, Missed: ${missed}`;

  drawPieChart(completed, missed);
}
let observing = false;

function toggleObservation() {
  if (observing) {
    closeObservation();
  } else {
    showObservation();
  }
}
function closeObservation() {
  observing = false;

  document.getElementById("observationPanel").style.display = "none";
  document.getElementById("taskList").style.display = "block";
}
function drawPieChart(completed, missed) {
  const canvas = document.getElementById("obsChart");
  const ctx = canvas.getContext("2d");
  const total = completed + missed;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (total === 0) return;

  let startAngle = 0;

  const completedAngle = (completed / total) * Math.PI * 2;
  ctx.fillStyle = "#2e7d32";
  ctx.beginPath();
  ctx.moveTo(100, 100);
  ctx.arc(100, 100, 80, startAngle, startAngle + completedAngle);
  ctx.fill();

  startAngle += completedAngle;

  const missedAngle = (missed / total) * Math.PI * 2;
  ctx.fillStyle = "#b71c1c";
  ctx.beginPath();
  ctx.moveTo(100, 100);
  ctx.arc(100, 100, 80, startAngle, startAngle + missedAngle);
  ctx.fill();
}
  
// --- Main Render ---
function render() {
  renderDateStrip();
  renderTasks();

  document.getElementById("taskInput").style.display =
    data.activeDate === today ? "block" : "none";
}

render();

</script>
</body>
</html>
